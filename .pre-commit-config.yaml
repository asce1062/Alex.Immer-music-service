# Pre-commit hooks configuration for monorepo (Python + TypeScript)
# Install: pre-commit install
# Run manually: pre-commit run --all-files
# Update hooks: pre-commit autoupdate

default_language_version:
  python: python3.11
  node: system

repos:
# ============================================================================
# General Pre-commit Hooks
# ============================================================================
- repo: https://github.com/pre-commit/pre-commit-hooks
  rev: v6.0.0
  hooks:
  # File format checks
  - id: check-yaml
    name: Check YAML syntax
    args: [ "--safe" ]
  - id: check-json
    name: Check JSON syntax
  - id: check-toml
    name: Check TOML syntax
  - id: check-xml
    name: Check XML syntax

  # File integrity checks
  - id: check-added-large-files
    name: Prevent large files (>500KB)
    args: [ "--maxkb=500" ]
  - id: check-case-conflict
    name: Check for case conflicts
  - id: check-merge-conflict
    name: Check for merge conflicts
  - id: check-symlinks
    name: Check for broken symlinks

  # Code quality checks
  - id: end-of-file-fixer
    name: Fix end of files
    exclude: '\.svg$'
  - id: trailing-whitespace
    name: Trim trailing whitespace
    args: [ --markdown-linebreak-ext=md ]
  - id: mixed-line-ending
    name: Fix mixed line endings
    args: [ "--fix=lf" ]
  - id: fix-byte-order-marker
    name: Remove UTF-8 BOM

  # Python-specific checks
  - id: check-ast
    name: Check Python AST
  - id: check-builtin-literals
    name: Check builtin type constructor use
  - id: check-docstring-first
    name: Check docstring is first
  - id: debug-statements
    name: Check for debugger imports

  # Security checks
  - id: detect-private-key
    name: Detect private keys

# ============================================================================
# Secret Detection - Gitleaks
# ============================================================================
- repo: https://github.com/gitleaks/gitleaks
  rev: v8.22.1
  hooks:
  - id: gitleaks
    name: Detect secrets and credentials

# ============================================================================
# Terraform Formatting
# ============================================================================
- repo: https://github.com/antonbabenko/pre-commit-terraform
  rev: v1.96.2
  hooks:
  - id: terraform_fmt
    name: Format Terraform files
  - id: terraform_validate
    name: Validate Terraform files
    args:
    - --hook-config=--retry-once-with-cleanup=true
  - id: terraform_docs
    name: Generate Terraform docs
    args:
    - --hook-config=--path-to-file=README.md
    - --hook-config=--add-to-existing-file=true
    - --hook-config=--create-file-if-not-exist=true

# ============================================================================
# Python Code Formatting - Black (Prettier equivalent)
# ============================================================================
- repo: https://github.com/psf/black
  rev: 25.9.0
  hooks:
  - id: black
    name: Format code with Black
    language_version: python3.11
    args: [ "--config", "pyproject.toml" ]

# ============================================================================
# Python Import Sorting - isort
# ============================================================================
- repo: https://github.com/PyCQA/isort
  rev: 7.0.0
  hooks:
  - id: isort
    name: Sort imports with isort
    args: [ "--settings-path", "pyproject.toml" ]

# ============================================================================
# Python Linting - Ruff (ESLint equivalent)
# ============================================================================
- repo: https://github.com/astral-sh/ruff-pre-commit
  rev: v0.14.2
  hooks:
  # Run the linter
  - id: ruff
    name: Lint with Ruff
    args: [ "--fix", "--exit-non-zero-on-fix" ]
    types_or: [ python, pyi ]

  # Run the formatter
  - id: ruff-format
    name: Format with Ruff
    types_or: [ python, pyi ]

# ============================================================================
# Python Type Checking - mypy
# ============================================================================
- repo: https://github.com/pre-commit/mirrors-mypy
  rev: v1.18.2
  hooks:
  - id: mypy
    name: Type check Python with mypy
    files: "^scripts/"
    args: [ "--config-file=pyproject.toml", "--ignore-missing-imports" ]
    additional_dependencies: [ "types-PyYAML", "types-Pillow" ]
    exclude: "^scripts/tests/"

# ============================================================================
# TypeScript/JavaScript Formatting - Prettier
# ============================================================================
- repo: https://github.com/pre-commit/mirrors-prettier
  rev: v4.0.0-alpha.8
  hooks:
  - id: prettier
    name: Format TypeScript/JS with Prettier
    types_or: [ javascript, jsx, ts, tsx, json, yaml, markdown ]
    exclude: "^scripts/"
    additional_dependencies:
    - prettier@3.6.2
    - prettier-plugin-astro@0.14.1

# ============================================================================
# TypeScript/JavaScript Linting - ESLint
# ============================================================================
- repo: https://github.com/pre-commit/mirrors-eslint
  rev: v9.20.0
  hooks:
  - id: eslint
    name: Lint TypeScript/JS with ESLint
    files: '\.(jsx?|tsx?)$'
    exclude: "^scripts/"
    types: [ file ]
    additional_dependencies:
    - eslint@9.17.0
    - "@typescript-eslint/eslint-plugin@8.46.2"
    - "@typescript-eslint/parser@8.46.2"
    - typescript@5.6.3
    - eslint-config-prettier@10.0.1

# ============================================================================
# Python Security Linting - bandit
# ============================================================================
- repo: https://github.com/PyCQA/bandit
  rev: 1.8.6
  hooks:
  - id: bandit
    name: Security check with bandit
    args: [ "-c", "pyproject.toml" ]
    additional_dependencies: [ "bandit[toml]" ]
    exclude: "^scripts/tests/"

# ============================================================================
# Python Dead Code Detection - vulture (Knip equivalent)
# ============================================================================
- repo: https://github.com/jendrikseipp/vulture
  rev: v2.14
  hooks:
  - id: vulture
    name: Find dead code with vulture
    args: [ "scripts/", "--min-confidence=80", "--exclude=scripts/tests/" ]

# ============================================================================
# Python Docstring Coverage
# ============================================================================
- repo: https://github.com/econchick/interrogate
  rev: 1.7.0
  hooks:
  - id: interrogate
    name: Check docstring coverage
    args: [ "--verbose", "--fail-under=80", "--ignore-init-method", "--ignore-init-module", "--ignore-magic", "--ignore-nested-functions", "--exclude=scripts/tests" ]
    pass_filenames: false

# ============================================================================
# Markdown Linting
# ============================================================================
- repo: https://github.com/igorshubovych/markdownlint-cli
  rev: v0.45.0
  hooks:
  - id: markdownlint
    name: Lint Markdown files
    args: [ "--fix" ]

# ============================================================================
# YAML Linting
# ============================================================================
- repo: https://github.com/adrienverge/yamllint
  rev: v1.37.1
  hooks:
  - id: yamllint
    name: Lint YAML files
    args: [ "-d", "{extends: default, rules: {line-length: {max: 120}}}" ]

# ============================================================================
# Shell Script Linting
# ============================================================================
- repo: https://github.com/shellcheck-py/shellcheck-py
  rev: v0.11.0.1
  hooks:
  - id: shellcheck
    name: Lint shell scripts

# ============================================================================
# Commit Message Linting
# ============================================================================
- repo: https://github.com/compilerla/conventional-pre-commit
  rev: v4.3.0
  hooks:
  - id: conventional-pre-commit
    name: Check commit message format
    stages: [ commit-msg ]

# ============================================================================
# CI-specific settings
# ============================================================================
ci:
  autofix_commit_msg: |
    [pre-commit.ci] auto fixes from pre-commit hooks

    for more information, see https://pre-commit.ci
  autofix_prs: true
  autoupdate_branch: ""
  autoupdate_commit_msg: "[pre-commit.ci] pre-commit autoupdate"
  autoupdate_schedule: weekly
  skip: []
  submodules: false
